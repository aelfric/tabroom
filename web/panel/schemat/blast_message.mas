<%args>
	$round
	$tourn
	$tourn_settings
	$person
	$others => undef
</%args>
<%init>

	my $event = $round->event;
	my $event_type = $event->type;

	$event_type = "debate"
		if $event_type eq "wsdc"
		|| $event_type eq "parli";

</%init>
			<script>
				function sendMessage() {
					const message = $('input[name="m_message"]').val();
					const timeslot = $('input[name="m_timeslot"]:checked').val();

					if (message) {
						const data = {
							recipients : $('input[name="m_recipients"]:checked').val(),
							status     : $('input[name="m_status"]').val(),
							flight     : $('input[name="m_flight"]').val(),
							message
						};

						let url = '/v1/tourn/<% $tourn->id %>/round/<% $round->id %>/message';
						if (timeslot) {
							url = '/v1/tourn/<% $tourn->id %>/timeslot/<% $round->timeslot->id %>/message';
						}

						$.ajax({
							type    : 'POST',
							url     : url,
							data    : data,
							success : function(data) {
								console.log('Yes I have no bananas');
								if (data.error) {
									alertify.warning(data.message);
								} else {
									alertify.notify(data.message, "custom");
								}
							}
						});

					} else {
						alertify.warning('No message to blast was entered');
					}
				}
			</script>

			<div class="full nospace martopmuchmore">
				<span class="third nospace">
					<h5>Message Only</h5>
				</span>

				<span class="twothirds nospace rightalign martop">
					Send message only to entries and judges
					in <% $round->realname %> of <% $event->name %>.
				</span>
			</div>

			<div class="row">
				<span class="quarter semibold nospace">
					<span class="spacer"></span>
					Message
				</span>

				<span class="threequarters">
					<input
						type        = "text"
						name        = "m_message"
						maxlength   = "155"
						placeholder = "Limited to 155 characters"
						size        = "72"
						onKey = "sendMessage();"
					>
				</span>
			</div>

			<div class="row">
				<span class="quarter nospace">
					<span class='spacer'></span>
					Send to
				</span>

				<span class="threequarters nospace">
					<label for="m_entries">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_recipients"
								id    = "m_entries"
								value = "entries"
							> Entries
						</span>
					</label>

					<label for="m_judges">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_recipients"
								id    = "m_judges"
								value = "judges"
							> Judges
						</span>
					</label>

					<label for="m_all">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_recipients"
								id    = "m_all"
								value = "all"
								checked
							> Both
						</span>
					</label>
				</span>
			</div>

%			if ($round->flighted > 1) {

				<div class="row">
					<span class="quarter">
						Flight
					</span>

					<span class="threequarters nospace">
						<label for="m_flight_all">
							<span class="quarter hover leftalign">
								<input
									type  = "radio"
									id    = "m_flight_all"
									name  = "m_flight"
									value = ""
									checked
								> All
							</span>
						</label>

%						foreach my $tick (1 .. $round->flighted) {
							<label for="m_<% $tick %>">
								<span class="quarter hover leftalign">
									<input
										type  = "radio"
										id    = "m_<% $tick %>"
										name  = "m_flight"
										value = "<% $tick %>"
									> <% $tick %>
								</span>
							</label>
%						}
					</span>
				</div>
%			}

			<div class="row">
				<span class="quarter nospace">
					<span class='spacer'></span>
					Section status
				</span>

				<span class="threequarter nospace">
					<label for="m_status_all">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_status"
								id    = "m_status_all"
								value = "all"
								checked
							> All Sections
						</span>
					</label>

					<label for="m_status_unstarted">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_status"
								id    = "m_status_unstarted"
								value = "unstarted"
							> Unstarted
						</span>
					</label>

					<label for="m_status_unentered">
						<span class="quarter hover">
							<input
								type  = "radio"
								name  = "m_status"
								id    = "m_status_unentered"
								value = "unentered"
							> Unentered
						</span>
					</label>

					<label for="m_status_unconfirmed">
						<span class="quarter nowrap hover">
							<input
								type  = "radio"
								name  = "m_status"
								id    = "m_status_unconfirmed"
								value = "unconfirmed"
							> Unconfirmed
						</span>
					</label>
				</span>
			</div>

%			if ($others && scalar @{$others} > 1) {
				<div class="row">
					<label for="m_timeslot">
						<span class="quarter nospace">
							<span class='spacer'></span>
							Entire timeslot?
						</span>

						<span class="fifth nospace padvert">
							<span class="quarterspacer"></span>
							<input
								type  = "checkbox"
								name  = "m_timeslot"
								id    = "m_timeslot"
								value = "1"
							> Yes
						</span>
					</label>

					<span class="half nospace" title="Will include these rounds in the blast">
%						foreach my $other (@{$others}) {
							<span class="sixth nospace explain">
								<% $other->event->abbr %> <% $other->name %>
							</span>
%						}
					</span>
				</div>
%			}

			<div class="liblrow rightalign marbottom">
				<span class="third centeralign nospace">
					<button
						type    = "button"
						class   = "buttonwhite bluetext invert thinnish"
						onClick = "sendMessage();"
					>Send Message</button>
				</span>
			</div>
