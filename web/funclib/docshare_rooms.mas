<%args>
	$round => undef
</%args>
<%init>

    use REST::Client;
	use MIME::Base64;

	Tab::debuglog("Docshare was summoned");

	unless (
		$round->event->type eq "debate"
		&& ( $round->event->setting("auto_docshare"))
	) {
		return "Not today, Satan";
	}

	my $share_url = $Tab::indexcards_url.'/ext/share/makeShareRooms';
	my $auth_header = encode_base64($Tab::indexcards_user.":".$Tab::indexcards_key);

	my $post_data = ({
		roundId => $round->id,
	});

	my $post = JSON::encode_json($post_data);

    my $client = REST::Client->new(
        host => $Tab::indexcards_url
    );

	$client->POST(
		$share_url,
		$post,
		{
			'Authorization' => "Basic $auth_header",
			'Accept'        => 'application/json',
			'Content-Type'  => 'application/json'
		}
	);

	Tab::debuglog("Posting docshare rooms with auth $auth_header");
	Tab::debuglog("Client response was");
	Tab::debuglog($client->responseContent());
	Tab::debuglog("Posting docshare rooms with auth $auth_header");

	return "I DID IT";

</%init>
