<%args>
	$tourn
	$tourn_settings
	$school
	$status => undef;
</%args>
<%init>

	return unless $school;
	return unless $tourn_settings->{"nsda_nats"};
	if ($status) {
	} else {
		%{$status} = $m->comp("/funclib/nsda/school_status_data.mas", school => $school);
	}

	my %measure;

	if ($ARGS{"smol"}) {
		$measure{"header"}    = "fifth";
		$measure{"status"}    = "twenty";
		$measure{"icon"}      = "fa-sm";
		$measure{"reason"}    = "seventenths padvertless";
	} else {
		$measure{"header"} = "tenth padvert";
		$measure{"status"} = "tenth";
		$measure{"icon"}   = "fa-lg";
		$measure{"reason"} = "fourfifths true"
	}

</%init>

%	unless ($ARGS{"smol"}) {

		<h5 class="padtop">Registration Status</h5>

		<div class="centeralign ">
			<span class="ninetenths leftalign flexkids">
				<div class="yellowrow smallish semibold padvertno marverto bluebordertop">
					<span class='<% $measure{"header"} %>'>
						Area
					</span>

					<span class='<% $measure{"reason"} %> '>
						Issues
					</span>

					<span class='<% $measure{"status"} %> centeralign '>
						Status
					</span>
				</div>
%	}
			<div class="odd noborder">
				<div class="full borderbottom flexrow">
					<span class='<% $measure{"header"} %> semibold bluetext'>
						School
					</span>

					<span class='<% $measure{"reason"} %> padleft'>
%						if ($status->{contacts} ) {
							<p class="smallish">
								<% $status->{contacts} %>
							</p>
%						} else {
							<span class="italic smallish">Hotel, Contact and Coach requirements are complete</span>
%						}
					</span>

					<span class='<% $measure{"status"} %> centeralign '>
%						if ($status->{contacts} ) {
							<span class="fa <% $measure{"icon"} %> fa-times redtext"></span>
%						} else {
							<span class="fa <% $measure{"icon"} %> fa-check greentext"></span>
%						}
					</span>
				</div>
			</div>

			<div class="odd noborder">
				<div class="full marno flexrow">
					<span class='<% $measure{"header"} %> semibold bluetext'>
						Students
					</span>

					<span class='<% $measure{"reason"} %> smallish padleft'>
%						unless ($status->{"students"}) {
							<span class="italic"> Student information is complete</span>
%						} else {
%							foreach my $student_id (sort keys %{$status->{"students"}}) {
%								my $student = $status->{'students'}{$student_id};
								<div class='full nospace'>
%									if ($ARGS{"admin"}) {
										<a
											class="white padvertless flexrow wrap"
											href="/register/entry/edit.mhtml?entry_id=<% $student->{"entry_id"} %>"
										>
%									} else {
										<a
											class = "white padvertless flexrow"
											href = "/user/enter/nats/entries.mhtml?school_id=<% $school->id %>"
										>
%									}
										<span class="padvertless threetenths">
											<% $student->{name} %>
										</span>

										<span class="seventenths">
%											foreach my $problem (@{$student->{problems}}) {
												<div class="full  padvertless">
													<% $problem %>
												</div>
%											}
										</span>
									</a>
								</div>
%							}
%						}
					</span>

					<span class='<% $measure{"status"} %> centeralign'>
%						unless ($status->{"students"}) {
							<span class="fa <% $measure{"icon"} %> fa-check greentext"></span>
%						} else {
							<span class="fa <% $measure{"icon"} %> fa-times redtext"></span>
%						}
					</span>
				</div>
			</div>

			<div class="odd bordertop">
				<div class="full flexrow">
					<span class='<% $measure{"header"} %> semibold bluetext'>
						Entries
					</span>

					<span class='<% $measure{"reason"} %> smallish padleft'>
%						unless ($status->{"entries"}) {
							<span class="italic">Entry information is complete</span>
%						} else {
%							my $notfirst;
%							foreach my $entry_id (sort keys %{$status->{"entries"}}) {
%								my $entry = $status->{'entries'}{$entry_id};

								<div class='full  <% $notfirst++ ? "ltbordertop" : "" %>'>
%									if ($ARGS{"admin"}) {
										<a
											class="white padvertless flexrow wrap full"
											href="/register/entry/edit.mhtml?entry_id=<% $entry_id %>"
										>
%									} else {
										<a
											class = "white padvertless flexrow wrap full"
											href = "/user/enter/nats/entries.mhtml?school_id=<% $school->id %>"
										>
%									}
										<span class="threetenths link-underline">
											<% $entry->{name} %>
										</span>

										<span class="flexrow seventenths smallish">
											<span class="sixth semibold leftalign">
												<% $entry->{event_abbr} %>
											</span>
											<span class="fivesixths">
%												if ($entry->{"pending"}) {
													<% ${$entry->{problems}}[0] %>
%												} elsif ($entry->{"problems"}) {
%													foreach my $reason (@{$entry->{"problems"}}) {
														<div class="full  padvertless">
															<% $reason %>
														</div>
%													}
%												}
											</span>
										</span>
									</a>
								</div>
%							}
%						}
					</span>

					<span class='<% $measure{"status"} %> centeralign'>
%						unless ($status->{"entries"}) {
							<span class="fa <% $measure{"icon"} %> fa-check greentext"></span>
%						} else {
							<span class="fa <% $measure{"icon"} %> fa-times redtext"></span>
%						}
					</span>
				</div>
			</div>

			<div class="odd bordertop">
				<div class="full flexrow">
					<span class='<% $measure{"header"} %> semibold bluetext'>
						Judging
					</span>

					<span class='<% $measure{"reason"} %>  smallish'>
%						unless ($status->{"judging"}) {
							<span class='italic'> Judging needs are met</span>
%						} else {
%							foreach my $category_id (sort keys %{$status->{"judging"}}) {
%								my $category = $status->{'judging'}{$category_id};
%								my $notfirst;

%								if ($category->{"unmet"}) {
									<div class='full  <% $notfirst++ ? "ltbordertop" : "" %>'>
										<a
											class="white flexrow wrap padvertless"
%											if ($ARGS{"admin"}) {
												href="/register/school/judges.mhtml?school_id=<% $school->id %>"
%											} else {
												href="/user/enter/nats/judges.mhtml?school_id=<% $school->id %>"
%											}
										>
											<span class="threetenths nowrap padleft">
												<% $category->{abbr} || $category->{name} %>
											</span>

											<span class="seventenths nospace">
%												foreach my $reason (@{$category->{"problems"}}) {
													<div class="full padvertless">
														<% $reason %>
													</div>
%												}
											</span>
										</a>
									</div>
%								}

%								foreach my $judge_id (sort keys %{$category->{"judges"}}) {

%									my $judge = $category->{'judges'}{$judge_id};

									<div class='full  <% $notfirst++ ? "ltbordertop" : "" %>'>
										<a
											class="white flexrow wrap padvertless"
%											if ($ARGS{"admin"}) {
												href="/register/judge/edit.mhtml?judge_id=<% $judge_id %>"
%											} else {
												href="/user/enter/nats/judge_edit.mhtml?judge_id=<% $judge_id %>"
%											}
										>
											<span class="nospace threetenths link-underline padleft">
												<% $judge->{name} %>
											</span>

											<span class="nospace seventenths">
%												foreach my $reason (@{$judge->{"problems"}}) {
													<div class="full  padvertless">
														<% $reason %>
													</div>
%												}
											</span>
										</a>
									</div>
%								}
%							}
%						}
					</span>

					<span class='<% $measure{"status"} %> centeralign '>
%						if ($status->{"judging"}) {
							<span class="fa <% $measure{"icon"} %> fa-times redtext"></span>
%						} else {
							<span class="fa <% $measure{"icon"} %> fa-check greentext"></span>
%						}
					</span>
				</div>
			</div>

			<div class="odd bordertop">
				<span class='<% $measure{"header"} %> semibold bluetext'>
					Fees
				</span>

				<span class='<% $measure{"reason"} %>  <% $status->{"fees"}{"amount_due"} ? "" : "c" %> '>
%					if ($status->{"fees"}{"amount_due"}) {
						<a
							class="white padvertless smallish flexrow wrap padleft"
%							if ($ARGS{"admin"}) {
								href="/register/school/invoice.mhtml?school_id=<% $school->id %>"
%							} else {
								href="/user/enter/fees.mhtml?school_id=<% $school->id %>"
%							}
						>
							<span class="threetenths">
								&#x24;<% $status->{"fees"}{"amount_due"} %> still owed
							</span>

							<span class="seventenths">
<%perl>
								my $notfirst;

								foreach my $tag ("entries", "bond", "concessions", "fines") {
									if ($status->{fees}{$tag}) {
										$m->print(" + ") if $notfirst++;
										$m->print('&#x24;'.$status->{"fees"}{$tag}." ".$tag);
									}
								}

								if ($status->{fees}{payments}) {
</%perl>
									<span class="inline redtext">
										&#x24;<% $status->{fees}{payments} * -1 %> payments
									</span>
%								}
							</span>
						</a>
%					} else {
						<span class="italic smallish padleft">Balance is paid</span>
%					}

				</span>

				<span class='<% $measure{"status"} %> centeralign '>
%					if ($status->{"fees"}{"amount_due"}) {
						<span class="fa <% $measure{"icon"} %> fa-times redtext"></span>
%					} else {
						<span class="fa <% $measure{"icon"} %> fa-check greentext"></span>
%					}
				</span>
			</div>

%		unless ($ARGS{"smol"}) {
			</span>
		</div>
%	}

%	return;
