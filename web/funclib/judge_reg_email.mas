<%args>
	$judge
	$person
	$category => undef
	$tourn    => undef
	$jperson  => undef
	$text     => undef
</%args>
<%init>

	unless ($jperson) {
		$jperson = $judge->person;
	}

	return unless $jperson;

	unless ($category) {
		$category = $judge->category;
	}

	unless ($tourn) {
		$tourn = $category->tourn;
	}

	unless ($text) {
		$text = $category->setting('registration_email');
	}

	return unless $text;

	my $message_text = $jperson->first." ".$jperson->last.",\n\tYou have been registered to judge ".$category->name." at the ".$tourn->name." ";
	$message_text .= "held at ".$tourn->city.", ";
	$message_text .= $tourn->state || $tourn->country;
	$message_text .= " on ";
	$message_text .= $m->comp('/funclib/showdate.mas',
		format => "murica",
		dt     => $tourn->start,
		tz     => $tourn->tz,
		return => 1
	);

	if ($tourn->start->day ne $tourn->end->day) {
		$message_text .= " to ";
		$message_text .= $m->comp('/funclib/showdate.mas',
			format => "murica",
			dt     => $tourn->end,
			tz     => $tourn->tz,
			return => 1
		);
	}

	$message_text .= ".\n";
	$message_text .= "You were registered by ".$person->first." ".$person->last." <".$person->email.">.\n";
	$message_text .= $text;

	my $result = $m->comp("/funclib/send_notify.mas",
		subject  => "You have been registered to judge ".$category->abbr." at ".$tourn->name."!",
		body     => $message_text,
		ids      => [$jperson->id],
		no_web   => 1,
		from     => $ARGS{"from_email"} || $person->first." ".$person->last." <".$tourn->webname.'@www.tabroom.com>',
		reply_to => $person->first." ".$person->last." <".$person->email.">",
	);

	return;
</%init>
