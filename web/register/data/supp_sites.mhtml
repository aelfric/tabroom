<%args>
	$person
	$tourn
	$tourn_settings
</%args>
<%init>

	my @sites = $tourn->sites;

	my @tabs = ("settings", "districts");

	my $supp_teams = $tourn_settings->{supp_teams};

</%init>

	<div class="main">

		<h3>Supp Site Location Split</h3>

		<& "/funclib/tabs.mas",
			tabs    => \@tabs,
			default => $ARGS{"default"} || "settings"
		&>

		<div class="screens settings">

			<h5>Settings</h5>

			<div class="splitpage">

				<span class="pagehalf">
%					my $tag = "supp_team_show_coaches";
					<div class="row flexrow">
						<label for="<% $tag %>">
							<span class="twothirds padleft">
								Show team locations on coach registrations
							</span>
							<span class="third centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => $tag,
									value   => $tourn_settings->{$tag},
									target  => $tourn,
									url     => "/setup/tourn/setting_switch.mhtml",
									smaller => 1,
								&>
							</span>
						</label>
					</div>

%					$tag = "supp_team_show_entries";
					<div class="row flexrow">
						<label for="<% $tag %>">
							<span class="twothirds padleft">
								Show team locations to competitors
							</span>
							<span class="third centeralign">
								<& "/funclib/bool_switch.mas",
									tag     => $tag,
									value   => $tourn_settings->{$tag},
									target  => $tourn,
									url     => "/setup/tourn/setting_switch.mhtml",
									smaller => 1,
								&>
							</span>
						</label>
					</div>
				</span>

				<span class="pagehalf">
%					my $warn = "This function will split all events, schedules, and pools between the teams";
					<div class="row flexrow fixedheight">
						<span class="fourfifths padleft">
							Split events, schedules and pools between sites
						</span>
						<span class="fifth">
							<a
								class   = "buttonwhite bluetext invert thinner full strong centeralign"
								onClick = "postConfirm('<% $warn %>', this, 'supp_sites_split.mhtml');"
							>Split</a>
						</span>
					</div>

%					$warn = "This function will re-merge all events, schedules, and pools between the teams.";
					<div class="row flexrow fixedheight">
						<span class="fourfifths padleft">
							Merge events, schedules and pools again
						</span>
						<span class="fifth">
							<a
								class   = "buttonwhite bluetext invert thinner full strong centeralign"
								onClick = "postConfirm('<% $warn %>', this, 'supp_sites_merge.mhtml');"
							>Merge</a>
						</span>
					</div>

%					$warn = "This function will re-align all school supp site assignments to their district's assignments, and split all competitors accordingly.";
					<div class="row flexrow fixedheight">
						<span class="fourfifths padleft">
							Realign schools to district selections
						</span>
						<span class="fifth">
							<a
								class   = "buttonwhite bluetext invert thinner full strong centeralign"
								onClick = "postConfirm('<% $warn %>', this, 'supp_sites_align.mhtml');"
							>Realign</a>
						</span>
					</div>
				</span>

			</div>

			<h5>Teams &amp; Sites</h5>

			<form
				action = "supp_sites_save.mhtml"
				method = "post"
			>

			<div class="yellowrow full flexrow semibold smallish padhorkids">
				<span class="twenty centeralign">
					Tag
				</span>
				<span class="nineteenth flexrow">
					<span class="fifth">
						Team Label
					</span>
					<span class="fifth">
						Wed Speech Site
					</span>

					<span class="fifth">
						Wed Debate Site
					</span>

					<span class="fifth">
						Thu Speech Site
					</span>

					<span class="fifth">
						Thu Debate Site
					</span>
				</span>
			</div>

%			foreach my $team_id (sort {$supp_teams->{$a}{code} cmp $supp_teams->{$b}{code}} keys %{$supp_teams}) {

%				my $team = $supp_teams->{$team_id};
				<div class="row full flexrow">
					<span
						class = "twenty centeralign padless"
						title = "Single letter code to identify team"
					>
						<input
							name        = "<% $team_id %>_code"
							type        = "text"
							class       = "thinner"
							placeholder = "Add"
							value       = "<% $team->{code} %>"
						>
					</span>
					<span class="nineteenth flexrow">
						<span class="fifth padleft padright">
							<input
								name        = "<% $team_id %>_label"
								type        = "text"
								placeholder = "New Team Label"
								value       = "<% $team->{label} %>"
							>
						</span>

						<span class="fifth">
							<select name="<% $team_id %>_wed_speech">
								<option value=""></option>
%								foreach my $site (@sites) {
									<option
										value="<% $site->id %>"
										<% $team->{wed_speech} eq $site ? "selected" : "" %>
									><% $site->name %></option>
%								}
							</select>
						</span>

						<span class="fifth">
							<select name="<% $team_id %>_wed_debate">
								<option value=""></option>
%								foreach my $site (@sites) {
									<option
										value="<% $site->id %>"
										<% $team->{wed_debate} eq $site ? "selected" : "" %>
									><% $site->name %></option>
%								}
							</select>
						</span>

						<span class="fifth">
							<select name="<% $team_id %>_thu_speech">
								<option value=""></option>
%								foreach my $site (@sites) {
									<option
										value="<% $site->id %>"
										<% $team->{thu_speech} eq $site ? "selected" : "" %>
									><% $site->name %></option>
%								}
							</select>
						</span>

						<span class="fifth">
							<select name="<% $team_id %>_thu_debate">
								<option value=""></option>
%								foreach my $site (@sites) {
									<option
										value="<% $site->id %>"
										<% $team->{thu_debate} eq $site ? "selected" : "" %>
									><% $site->name %></option>
%								}
							</select>
						</span>
					</span>
				</div>
%			}

			<div class="row full flexrow">
				<span
					class = "twenty centeralign padless"
					title = "Single letter code to identify team"
				>
					<input
						name        = "new_code"
						type        = "text"
						class       = "thinner"
						placeholder = "Add"
					>
				</span>
				<span class="nineteenth flexrow">
					<span class="fifth padleft padright">
						<input
							name        = "new_label"
							type        = "text"
							placeholder = "New Team Label"
						>
					</span>

					<span class="fifth">
						<select name="new_wed_speech">
							<option value=""></option>
%							foreach my $site (@sites) {
								<option
									value="<% $site->id %>"
								><% $site->name %></option>
%							}
						</select>
					</span>

					<span class="fifth">
						<select name="new_wed_debate">
							<option value=""></option>
%							foreach my $site (@sites) {
								<option
									value="<% $site->id %>"
								><% $site->name %></option>
%							}
						</select>
					</span>

					<span class="fifth">
						<select name="new_thu_speech">
							<option value=""></option>
%							foreach my $site (@sites) {
								<option
									value="<% $site->id %>"
								><% $site->name %></option>
%							}
						</select>
					</span>

					<span class="fifth">
						<select name="new_thu_debate">
							<option value=""></option>
%							foreach my $site (@sites) {
								<option
									value="<% $site->id %>"
								><% $site->name %></option>
%							}
						</select>
					</span>
				</span>
			</div>

			<div class="libl full rightalign">
				<span class="third centeralign">
					<input
						type  = "submit"
						value = "Save Teams"
					>
				</span>
			</div>
		</div>

		<h5>Notes</h5>

		<p>
			To delete a team, just delete the code and save.  It'll go poof.
			Don't do that mid tournament or it'll be pretty bad.
		</p>

		<p>
			The site assignments here are 1) Informational for
			teams/entries/judges and 2) govern how things are scheduled WHEN
			THE SPLIT HAPPENS. If you change the site assignments the
			site/location of judge pools and rounds IS NOT UPDATED.
		</p>

	</div>

	<&
		"menu.mas",
		tourn          => $tourn,
		tourn_settings => $tourn_settings,
		whoami         => "supp_sites",
		person         => $person
	&>
